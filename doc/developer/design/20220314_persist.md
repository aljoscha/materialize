# Persist (v2, the one for PLATFORM)

## Summary

Persist is an API and a runtime and a bunch of semantics. It's meant to be the
thing that backs STORAGE, and maybe other things. Sources will be ingested into
persist to make them durable, the results of queries can also be written into
persist to make them available for other queries or shove them over to "sinks",
whatever that will look like.

It's the component that will make the separation of STORAGE and COMPUTE
possible.

## Goals

- Be the thing that backs STORAGE and makes PLATFORM possible.
- Be correct, in the sense of exactly-once, with fault tolerance, high
  availability, all the good stuff.
- Concrete: writers should be able to write down definite data, consumers will
  be able to read that data. And we shouldn't lose the data.
- Handle multiple, concurrent writers.
- Maybe don't have too much write amplification?
- Don't preclude other things that we want to offer in the future, see
  non-goals below.
- Have thoughts on backwards compatibility of the storage format.

## Non-Goals

- Be fast, as in throughput in latecy. Though we still need to be fast enough,
  tbd what that means.
- Be able to compact written data. As in differential compaction/consolidation,
  with read frontiers and the like.
- Solve sharding. That seems to be a thing that STORAGE does.

## Description

Insert brief overview here. Touch on concepts, API, and implementation.

### Concepts

We need to introduce the involved actors. Describe the relevant features of
STORAGE and COMPUTE, and where we fit in.

Describe our concepts: collections, readers, writers, read/write capabilities,
snapshots, and listening. Go into some details, e.g. what describes
collections, sinces and uppers. We should probably have something like the
_jargon_ section from the current persist README here.

We also need to describe the guarantees that writesrs need to uphold: multiple
writers must write the same (in terms of definite) data.

Describe the guarantees that we uphold.

### API

Describe how the things described in Concepts map to an API.

_Definitely_ a section on error handling and how retries are/should be handled.

### Implementation

Maybe go into how the state machine is the core of things, how it works.

Describe how we use a `BLOB` and `LOG` internally and what guarantees/features
we need from them. Maybe go into specific implementations, thinking S3 and
etcd, maybe.

Potentially go into our intended storage format, and how that will help us stay
somewhat backwards compatible as we progress and add more of the roadmap
features.

### Operations

Very rough: sketch what the expected pain points (or not) in operating this are.

### Example Usage

Sketch our main use cases. Maybe outline how we would do source persistence
with this, describe the Kafka Example.

We should outline how this will be used by PLATFORM, and STORAGE in particular.

## Alternatives

<!--
// Similar to the Description section. List of alternative approaches considered, pros/cons or why they were not chosen
-->

## Open questions

<!--
// Anything currently unanswered that needs specific focus. This section may be expanded during the doc meeting as
// other unknowns are pointed out.
// These questions may be technical, product, or anything in-between.
-->
